BINDIR = $(PREFIX)/bin/
DATADIR = $(PREFIX)/share/
APPDIR = $(DATADIR)/applications/
PACKAGE = lterm
VERSION = 1.6.0
MYDATADIR = $(DATADIR)/$(PACKAGE)/data/
MYIMGDIR = $(DATADIR)/$(PACKAGE)/img/

SRCS = $(wildcard src/*.c)
OBJS = $(SRCS:.c=.o)
DEPS = $(OBJS:.o=.d)

CFLAGS += -DPACKAGE=\"$(PACKAGE)\" -DVERSION=\"$(VERSION)\" -DIMGDIR=\"$(MYIMGDIR)\" -DDATADIR=\"$(MYDATADIR)\"

all: $(PACKAGE)

-include $(DEPS)

%.d: %.c
	@$(CPP) $(CFLAGS) $< -MM -MT $(@:.d=.o) > $@

$(PACKAGE): $(OBJS)
	$(CC) -o $@ $^ $(LDFLAGS)

lterm.desktop: data/lterm.desktop.in
	sed -e 's!IMGDIR!$(DATADIR)/$(PACKAGE)/img!' < $< > $@

install: lterm lterm.desktop
	install $(PACKAGE) $(BINDIR)/
	install -d $(MYDATADIR)
	install -d $(MYIMGDIR)
	install -d $(APPDIR)
	install -t $(MYDATADIR) data/*
	install -t $(MYIMGDIR) img/*
	install -t $(APPDIR) lterm.desktop

uninstall:
	-rm -f $(BINDIR)/$(PACKAGE)
	-rm -f $(MYDATADIR)/*
	-rm -f $(MYIMGDIR)/*
	-rm -f $(APPDIR)/lterm.desktop
	-rmdir $(MYDATADIR)
	-rmdir $(MYIMGDIR)
	-rmdir $(DATADIR)/$(PACKAGE)

clean:
	-rm -f $(OBJS) lterm
	-rm -f $(DEPS)
	-rm -f lterm.desktop

.PHONY: all install uninstall clean

